---
title: redis standard
layout: post
date: 2017-03-23 22:35:24 +0800
categories: redis
tags: redis
---




* content
{:toc}
域名解析服务
1. 域名解析系统能做什么？
2.  怎么判断域名能否正常解析？
3. 域名解析不了，我该怎么办？
4.  域名ping不通怎么办？
5. 域名变更多长时间生效？
6. 域名解析到了哪个IP地址？
7. 公网域名和私网域名的区别是什么?
8. 我的域名被运营商劫持了，找谁处理？
1. 域名解析系统能做什么？
域名系统通常用途是将域名解析成IP地址（无法解析到IP对应的端口）。申请域名的时候，确认是否需要分配VIP：

若需要：域名会解析到VIP上，然后通过负载均衡服务将请求分发到业务服务器上。
若不需要：域名将直接解析到服务器上，当服务器宕机，需要域名所属人员通过dns自助服务将服务器从域名解析上删除。
2.  怎么判断域名能否正常解析？
    以测试p.3.local域名为例， 在命令行输入：ping   p.3.local

域名解析正确
屏幕输出：PING p.3.local (172.22.132.158) 56(84) bytes of data.

即说明域名已解析到172.22.132.158这个IP上。

域名无法解析
屏幕输出：unknown host p.3.local

即说明域名无法解析。

3. 域名解析不了，我该怎么办？
  如果在数据中心（机房），请先检查本机的nameserver设置（正确的地址是：172.16.16.16， 10.16.16.16），以Centos 6为例： cat /etc/resolv.conf
 如果设置正确，并运行 dig @172.16.16.16可以解析，请重启本地nscd服务， 以centos 6为例，重启方法： service nscd restart
 如果运行dig @172.16.16.16不可以解析，traceroute -n -q 1 172.16.16.16， 将traceroute输出发邮件.
 如果在办公网发现解析不了，请联系桌面技术支持；
    如果本机没有dig命令， 请安装bind-utils软件包。

4.  域名ping不通怎么办？
     1. 检查域名是否可以解析以及解析的IP地址是否正确

     2. 如果域名可以解析，并且解析结果正确，请联系网络值班（153-1150-7695）

5. 域名变更多长时间生效？
   域名变更生效时间可以通过设置TTL来控制解析记录在DNS缓存上的缓存时间。

   通常情况下DNS缓存会在一个TTL周期内更新解析记录，但在公网上也存在不遵守协议规范的情况造成有部分用户解析记录还没有更新。发生这种情况需要联系运营商清缓存。

6. 域名解析到了哪个IP地址？
查询域名在公网解析的所有IP，可以通过ops系统查询;
查询当前主机访问域名对应的IP，在命令行输入： nslookup  域名。
例如： nslookup www.baidu.com/
7. 公网域名和私网域名的区别是什么?
公网域名：指域名以.com, .cn, .hk等结尾的域名；一般由公网用户或办公网用户申请使用。
私网域名：指IDC机房内部使用以.local结尾的域名（例如：baidu.local）；主要在机房内部服务调用； 如果机房内部调用使用公网域名，会导致域名解析延迟增加。
  注 ：申请域名时，请确定域名用途。

8. 我的域名被运营商劫持了，找谁处理？
   请联系CTO体系-信息安全部-安全系统监控部
负载均衡服务
1. 通过域名访问慢怎么办？
2. 通过域名访问服务异常？
3. 通过域名访问跳首页，怎么办？
4. 用户反馈访问域名（或vip）有问题，而绑定后端服务器测试没问题？
5. 服务器负载不均怎么办？
6. 服务器下线后还有流量怎么办？
7. 域名共用VIP会不会有问题？
8. 升级到HTTPS，服务器端如何判断请求来自于HTTP还是HTTPS？
9. 已确认是VIP或者服务器的问题，如何处理？
10. VIP有没有探活的功能？
11. 域名开通HTTPS了吗？怎么开通？
12. 如何获取客户端的IP？
13. 如何获取客户端的端口号？
14. 需要负载层开启https配置么?
15. 可以在负载层上强制开启http转https么?
16. 为什么机器有大量请求来自负载均衡机器？
17. 服务器上应用程序如何获取入口VIP?
1. 通过域名访问慢怎么办？
通过np的【网络质量查询】，输入域名，查看是否解析到VIP上面，若已经解析到VIP，请依次将域名在本地绑定到VIP后面的服务器进行测试。
如果测试都没有问题，请将测试方法和测试结果发到dns

将域名绑定到IP的方法：例如：将a.baidu.com绑定到2.2.2.3这个IP上面:

windows操作：

   在c:\windows\system32\drivers\etc路径下的hosts文件，添加  2.2.2.3 a.baidu.com.com 内容。

linux操作：执行以下命令：

 # vim /etc/hosts
2.2.2.3 a.baidu.com.com

2. 通过域名访问服务异常？

访问流程图见左图

注：

域名测试方法，请参考：怎么判断域名能否正常解析？
域名解析不正常，请参考：域名解析不了，我该怎么办？
域名解析到VIP上，需要到DNS自助服务上查询VIP和IP的对应关系。
3. 通过域名访问跳首页，怎么办？
目前发生重定向跳转主页的现象，基本是由后端服务问题导致，当发生重定向跳转时，请确认重定向链接里是否包含lb=1参数，来确定是否是由VIP（负载均衡）层返回的错误码：

如果不包含，即不是VIP（负载均衡）返回的错误，请检查后端服务！
如果包含，目前，VIP（负载均衡）层针对以下几种情况，会返回重定向跳转到首面：
后端服务器健康检查失败
无服务器可用
连接后端服务重试2次都失败
http://www.baidu.com.com/lb=1&err=3
后端服务在接收到请求后，没有响应的情况下异常断开连接	http://www.baidu.com.com/lb=1&err=2
后端服务响应超时（默认超时时间：60秒）	http://www.baidu.com.com/lb=1&err=4
如果业务服务器返回错误码，负载均衡服务将错误直接转发到客户端，并不重定向跳转到首页。

4. 用户反馈访问域名（或vip）有问题，而绑定后端服务器测试没问题？
 让业务方提供一个url，测测是不是经过vip访问时有问题

 经过vip访问时，跳转到了，我们设定的错误页（haproxy.conf）

这种需要：
（1）检查vip上有没有这个域名的配置 （没这个域名的acl，也没有default_backend）
（2）后端超时时间设置是不是太短（之前是默认15s）等

 如果是跳转到了http://www.baidu.com.com ，这种多数是后端nginx（nginx标识：Server: baidu.comWS ）没有配置对应域名导致的，需检查后端nginx配置。

5. 服务器负载不均怎么办？
负载均衡策略默认是采取加权轮循的算法。

导致负载不均的原因：一般是开启了会话保持或长连接。

如果采用的是默认策略，且机器权重（weight）分配合理，请分析访问日志，检查每台服务器在一分钟内的的请求数是否相近:

如果相近，说明VIP（负载均衡）请求分发没有问题;
如果相差很大，请将访问日志分析结果发邮件到dns@baidu.com.com，确认负载均衡策略。
注：机器权重，需要根据机器本身的处理能力来分配。

6. 服务器下线后还有流量怎么办？
从VIP下线服务器后，一般需要1~2分钟完成线上生效；
分析访问日志，以Nginx为例 ，取remote_addr，确认来源IP是否为负载均衡服务器IP：
是：发邮件至dns@baidu.com.com。
否：联系服务器相应的负责人（IP的负责人或应用运维）。
7. 域名共用VIP会不会有问题？
目前，确认域名是否可以共用VIP，只能通过域名认领的方式来确认，如果认领成功，即表明该域名可以和其他域名共用。

8. 升级到HTTPS，服务器端如何判断请求来自于HTTP还是HTTPS？
     对于HTTPS请求，负载均衡层负责完成加解密；

    服务器通过读取HTTP请求头中的X-Proto字段判别，值为HTTP即为HTTP用户请求，值为SSL即为HTTPS用户请求。

HTTP请求
X-Proto: HTTP
HTTPS请求
X-Proto: SSL
9. 已确认是VIP或者服务器的问题，如何处理？
    确认某个VIP或服务器有问题后，为了快速恢复服务，请通过ops平台进行域名变更或VIP变更

服务器有问题：dns自助-VIP变更，从VIP里摘除。
VIP有问题：dns自助-解析变更，替换VIP。
10. VIP有没有探活的功能？
    负载均衡服务默认对后端服务进行端口探活，周期是30秒。

11. 域名开通HTTPS了吗？怎么开通？
      对于新申请的域名，默认就开通了HTTPS；

     检查是否开通HTTPS的方法：在浏览器地址栏中，输入以下内容：https://域名/

     如果提示连接被重置或跳转到http://www.baidu.com.com/lb=1&err=3 ，请联系dns@baidu.com.com， 且在邮件中注明域名信息。

12. 如何获取客户端的IP？
     1. 在Nginx日志格式中，可以通过$http_j_forwarded_for或$http_x_forwarded_for变量来获取J-Forwarded-For或X-Forwarded-For字段的值。

    这两个字段的区别如下：

J-Forwarded-For：该字段是负载均衡看到的客户端IP，若用户请求中带有J-Forwarded-For的话，将会被客户端IP覆盖。
X-Forwarded-For：该字段可能包括多个IP值，如果客户请求中带有这个字段，负载均衡会在这个字段中添加对端的IP地址。

  2, 通过Nginx realip module
      real_ip_header J-Forwarded-For;
   set_real_ip_from  172.16.0.0/12;
13. 如何获取客户端的端口号？
      在Nginx日志格式中，可以通过$http_x_baidu.comlb_client_port 变量来获取X-baidu.comlb-Client-Port 字段的值。

      http header中，X-baidu.comlb-Client-Port  字段用来透传客户端的端口。

14. 需要负载层开启https配置么?
    默认已经开启

15. 可以在负载层上强制开启http转https么?
    负载层只调度,不涉及业务逻辑. 可以在后端nginx配置强制https访问

16. 为什么机器有大量请求来自负载均衡机器？
    目前，服务器是挂在VIP后面对外提供服务的。可以通过以下方法获取服务器IP：

可以通过j-forwarded-for拿到调用端真实IP；
通过np.baidu.com.com，输入服务器IP可以查到域名和VIP信息；
如果没有显示域名信息，那么请联系运维。
17. 服务器上应用程序如何获取入口VIP?
header: X-Original-To，值：VIP











自助化平台使用
1. 我申请了一个DNS变更工单，接下来怎么处理？
2. 我变更解析后访问有问题，如何回滚？
3. 如何认领域名，域名认领后有哪些权限？
4. 如何进行域名申请（域名预留）？
5. 如何查询域名所属信息？
6. 如何进行域名解析变更？
7. 项目结束后域名没用了，想废除如何操作？
8. 域名没用了，其它项目要用，怎么转让？
9. 如何给域名申请 VIP ？
10. 给域名申请了多个 VIP ，不知道怎么用？
11. 如何维护备用 VIP?
12. 机房搬迁或 VIP 下服务器有问题，需要变更怎么办？
13. 能否对某业务下的多个域名进行整体流量切换？
14. 域名上线新功能或部署新程序，如何申请预发布VIP先测试下？
15. 如何快速查询某个域名解析情况、 VIP 或服务器所在机房？
16. 域名原持有人离职、转岗，域名持有人如何变更？
17. 测试环境可以访问线上的域名吗？
18.如何通过IP或者VIP查到域名相关信息？
19.域名申请即支持TCP协议，又支持Http协议，在申请域名时协议类型如何选择？
20.没有服务IP资源是否可以先申请域名吗？
21.如果域名有CND服务的，CDN服务会回源到此域名下的机器吗？
22.某个机房的机器下线了，DNS自助服务系统自动分配的VIP 还可以继续使用吗?
23.没有域名的VIP，VIP负责人调岗或者离职了，申请VIP转让该怎么操作？
24.申请域名流程要多久审批下来？
25.DNS自助服务系统上支持不同的域名对应同一个VIP吗？
26.同一个域名为什么在baidu.com无线网络下可以正常访问，但是在 baidu.com_accessx无线网络下无法访问？
27.一个vip要申请两个vport，在DNS自助系统上如何操作？
28.同一个域名只能一个人负责？
29. 如何启用备用VIP?
30.内网域名如何转公网使用？
31. 域名申请时报内外网属性错误？
32．域名申请关联不上J-ONE应用如何操作？
1. 我申请了一个DNS变更工单，接下来怎么处理？
     经理审批后，到待我处理里自行确认生效， 变更完成后，1~2分钟完成线上生效。

2. 我变更解析后访问有问题，如何回滚？
     DNS自助里点击域名回滚

3. 如何认领域名，域名认领后有哪些权限？
     ops.baidu.com.com->网络平台->我的域名->DNS自助服务->域名认领。已存在但未认领的域名，可进行域名认领。

     认领域名后，即享有域名和对应VIP相关的操作权限，域名第一拥有人，还可以赋权给部门其他人。

4. 如何进行域名申请（域名预留）？
    ops.baidu.com.com->网络平台->DNS自助服务->我的域名->域名申请（域名预留）。

   注：域名预留后如果想要启用，需由申请人先进行域名申请。

5. 如何查询域名所属信息？
   ops.baidu.com.com->网络平台->DNS自助服务->域名查询（可导出）

6. 如何进行域名解析变更？
    ops.baidu.com.com->网络平台-> DNS自助服务->我的域名->搜索指定域名->点击“解析变更”->选择变更类型和网络类型->修改每个用户所在机房(或运营商)想要解析到的VIP（或IP）->提交经理审批->经理审批后，再点“确认生效”按钮即可，约1分钟生效。

7. 项目结束后域名没用了，想废除如何操作？
    域名下线：对于部门不用的域名，请进行域名下线。

    步骤如下：ops.baidu.com.com->网络平台-> DNS自助服务->我的域名->搜索指定域名->点击“域名下线”按钮，提交经理审批->经理审批后，你再点“确认生效”按钮即可。

8. 域名没用了，其它项目要用，怎么转让？
     ops.baidu.com.com->网络平台->DNS自助服务->我的域名->搜索指定域名->点击“域名转让”（只有域名拥有人才有这个权限）。

9. 如何给域名申请 VIP ？
如果域名已经存在且已认领，在“我的域名”中搜索对应域名，进行“VIP申请”，申请后即可在备用VIP栏中看到；
如果域名不存在，通过域名申请，填写服务器ip和端口，我们会分配VIP。
10. 给域名申请了多个 VIP ，不知道怎么用？
VIP有已解析和备用VIP两种状态，务必确保备用vip的可用性，因为当某个机房有问题的时候，我们可能会私自将您的备用vip解析到线上。
对于服务器间调用域名，目前有永丰、黄村、廊坊、马驹桥等9个视图，代表用户所在的位置。
如果存在同机房的VIP，建议将该机房视图仅解析到该机房的VIP上；
如果没有同机房VIP，可以将该机房视图随意解析一个或多个VIP上。要保证每个视图都解析到了VIP上。
对于公网域名，目前有移动、联通、电信、其他运营商、港澳台海外5个视图，代表用户所在的网络，通常我们会分别分配一个同网络的VIP，建议将每个视图解析到同运营商VIP上，不要跨运营商解析（其他运营商建议解析到电信VIP上）。所以如果你的域名只有一个VIP，需要申请其他运营商的VIP了。
11. 如何维护备用 VIP?
      如果备用VIP不再使用，可以通过域名附加信息操作来删除。

      步骤：ops.baidu.com.com->网络平台-> DNS自助服务->我的域名->搜索指定域名->点击域名附加信息操作栏的修改，将没用的VIP删掉即可。

12. 机房搬迁或 VIP 下服务器有问题，需要变更怎么办？
如果VIP已有对应域名：ops.baidu.com.com->网络平台-> DNS自助服务->我的域名->搜索指定域名->点击“VIP变更”按钮->按示例增加或删除服务器->提交并确认生效即可，约1分钟生效。
如果vip没有对应域名：通过ops.baidu.com.com->网络平台->VIP自助服务->VIP变更操作->搜索对应的VIP（前提是该VIP变更权限已申请）->按示例增加或删除服务器->提交并确认生效即可，约1分钟生效。
13. 能否对某业务下的多个域名进行整体流量切换？
      流量切换：适用于将一组域名某个机房（运营商）的流量导入另一个机房（运营商）。步骤如下：ops.baidu.com.com->网络平台-> DNS自助服务->流量切换

先定义要操作的域名分组
再选择域名分组进行流量切换，指定流量切换的当前机房和目标机房。
流量切换完成后，可以查看切换记录或者回滚某次切换
14. 域名上线新功能或部署新程序，如何申请预发布VIP先测试下？
       HTTPS预发布VIP申请：ops.baidu.com.com->网络平台->HTTPS预发布自助化（注意：申请下来VIP后，需要绑hosts测试）

15. 如何快速查询某个域名解析情况、 VIP 或服务器所在机房？
       ops.baidu.com.com->网络平台->基础网络查询->搜索即可

16. 域名原持有人离职、转岗，域名持有人如何变更？
      原域名拥有人可对域名发起“转让”操作，双方经理审批后，接收人确认接收操作。

17. 测试环境可以访问线上的域名吗？
      测试环境与线上环境是隔离的，如想访问线上的域名，需打通防火墙限制，OPS系统-网络服务-基础网络-IDC网络权限申请

18.如何通过IP或者VIP查到域名相关信息？
     OPS系统-网络服务-基础网络查询，可根据IP or VIP or 域名反查到域名、VIP、VIP端口、VIP机房、交换机相关信息等。

19.域名申请即支持TCP协议，又支持Http协议，在申请域名时协议类型如何选择？
      域名申请时，需要VIP则支持TCP 、HTTP协议，公网开HTTP协议默认支持HTTPS。

      HTTP（应用层协议，WEB一般选择HTTP协议封装传输数据）

      TCP  （传输层协议，非WEB或者不需封装数据）

20.没有服务IP资源是否可以先申请域名吗？
      域名申请必须有IP，申请到IP资源后再域名申请，也可先对域名占用即域名预留，预留域名自动转为在线使用域名。

21.如果域名有CND服务的，CDN服务会回源到此域名下的机器吗？
     域名解析出现baidu.comcdn的，一般为CDN服务，CDN域名需联系CDN运维同事核实回源的IP

22.某个机房的机器下线了，DNS自助服务系统自动分配的VIP 还可以继续使用吗?
     只有在域名停止解析时，VIP才会发生回收。如果中途VIP不再使用，可在备用VIP里删除VIP信息并通知pid-lb@baidu.com.com删除VIP相关配置。

23.没有域名的VIP，VIP负责人调岗或者离职了，申请VIP转让该怎么操作？
    发需求邮件至pid-lb@baidu.com.com，值班人员会在OPS系统里取消原VIP负责人的权限，取消原VIP负责人权限后，为了方便后期VIP的使用维护，新接收人需在OPS系统里申请新域名，与VIP建立关联。

24.申请域名流程要多久审批下来？
    如果是紧急需求，可电话直接联系相关审批负责人。

25.DNS自助服务系统上支持不同的域名对应同一个VIP吗？
      域名申请时可选择对应的“业务主域”，业务主域即同一部门或者同一个应用，例如“无线”。

     业务主域里的域名可共享使用一个VIP或者一组VIP。

26.同一个域名为什么在baidu.com无线网络下可以正常访问，但是在 baidu.com_accessx无线网络下无法访问？
     PC端和移动端访问权限问题，请联系公司所属区域IT同事处理即可。

27.一个vip要申请两个vport，在DNS自助系统上如何操作？
     特殊需求可发需求邮件至pid-lb@baidu.com.com邮箱，联系运维值班同事后端手动配置。

28.同一个域名只能一个人负责？
     同一个域名可授权给N个负责人，在OPS系统里“域名附加信息操作”—“授权”搜索 erp追加授权人并且不受部门限制。

29. 如何启用备用VIP?
       如果备用VIP已经申请过但未启用，需要时启用。

       步骤：ops.baidu.com.com->网络平台-> DNS自助服务->我的域名->搜索指定域名->点击“解析变更”，输入需要解析的备用VIP即可。

       注意：备用VIP启用前必须再次测试确认业务正常。

30.内网域名如何转公网使用？
    NP系统自助操作：

       A、集群已创建情况下：

       （1）域名服务---我的域名--VIP申请（网络类型：公网）

       （2）线下测试绑定host测试公网VIP可用行

       （3）域名服务—域名解析—选择公网—填写公网VIP

     B、集群未创建情况下：

       （1）域名服务---后端集群--集群创建

       （2）域名服务---我的域名--VIP申请（网络类型：公网）

       （3）线下测试绑定host测试公网VIP可用行

       （4）域名服务—域名解析—选择公网—填写公网VIP

31. 域名申请时报内外网属性错误？
      请根据自己的需求，确定域名的服务类型，填写IP

     （1）公网域名，需要VIP，直接填写服务器IP

              公网域名，不需要VIP，请填写公网IP

     （2）内网域名，需要VIP，直接填写服务器IP

              内网域名，不需要VIP，请填写内网IP

32．域名申请关联不上J-ONE应用如何操作？
       先在J-one系统创建应用，再进行域名申请，注：在域名申请时，直接选择jone应用名称，由系统自动触发识别，而不是手工填写，如果手工填写会造成同步J-one应用失败问题等。




。
